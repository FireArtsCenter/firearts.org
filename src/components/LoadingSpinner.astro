---
/* Fire Arts Center - Centrifugal Forge Spinner */

interface Props {
	sparkCount?: number;
	loadingLabel?: string;
	size?: number;
}

const {
	sparkCount = 15,
	loadingLabel = 'Loading...',
	size = 140,
} = Astro.props;

const baseSize = 140;
const scale = size / baseSize;

const sparks = Array.from({ length: sparkCount }).map(() => {
	const radius = 35;
	const angle = Math.random() * 2 * Math.PI;
	const startX = 70 + radius * Math.cos(angle);
	const startY = 70 + radius * Math.sin(angle);
	const throwDistance = Math.random() * 40 + 20;
	const tx = Math.cos(angle) * throwDistance + 'px';
	const ty = Math.sin(angle) * throwDistance + 'px';

	return {
		left: startX + 'px',
		top: startY + 'px',
		tx,
		ty,
		duration: (Math.random() * 0.4 + 0.4).toFixed(2) + 's',
		delay: (Math.random() * 2).toFixed(2) + 's',
	};
});
---

<div
	class='spinner-wrapper'
	style={{ width: `${size}px`, height: `${size}px` }}
>
	<div
		class='forge-container'
		role='status'
		aria-label={loadingLabel}
		style={{ transform: `scale(${scale})` }}
	>
		<div class='vortex-ring'></div>
		{
			sparks.map((s) => (
				<div
					class='spark'
					style={{
						top: s.top,
						left: s.left,
						'--tx': s.tx,
						'--ty': s.ty,
						animationDuration: s.duration,
						animationDelay: s.delay,
					}}
				/>
			))
		}
	</div>
</div>

<style>
	.spinner-wrapper {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		vertical-align: middle;
		position: relative;
		overflow: visible;
		pointer-events: none;
	}

	.forge-container {
		--warm: var(--loading-spinner-warm, #990000);
		--warmer: var(--loading-spinner-warmer, #ff9900);
		--hottest: var(--loading-spinner-hotest, #ffffff);

		position: absolute;
		width: 140px;
		height: 140px;
		flex-shrink: 0;
		transform-origin: center center;
		background: transparent;
	}

	.vortex-ring {
		position: absolute;
		inset: 35px;
		border-radius: 50%;
		background: conic-gradient(
			from 0deg,
			transparent 15%,
			var(--warm) 45%,
			var(--warmer) 85%,
			var(--hottest) 100%
		);
		-webkit-mask: radial-gradient(
			farthest-side,
			transparent calc(100% - 5px),
			#000 0
		);
		mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 0);
		animation: molten-spin 1.8s linear infinite;
		z-index: 2;
	}

	.vortex-ring::after {
		content: '';
		position: absolute;
		top: -4px;
		left: 50%;
		transform: translateX(-50%);
		width: 10px;
		height: 10px;
		background: var(--hottest);
		border-radius: 50%;
		box-shadow: 0 0 15px 4px var(--warmer);
	}

	.spark {
		position: absolute;
		width: 2px;
		height: 2px;
		background: var(--hottest);
		border-radius: 50%;
		opacity: 0;
		z-index: 1;
		animation-name: centrifugal-ignite;
		animation-iteration-count: infinite;
		animation-timing-function: ease-out;
	}

	@keyframes molten-spin {
		to {
			transform: rotate(360deg);
		}
	}
	@keyframes centrifugal-ignite {
		0% {
			transform: translate(0, 0) scale(1);
			opacity: 0;
		}
		10% {
			opacity: 1;
		}
		100% {
			transform: translate(var(--tx), var(--ty)) scale(0);
			opacity: 0;
		}
	}
</style>
