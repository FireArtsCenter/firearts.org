---
/* Fire Arts Center - Centrifugal Forge Spinner */

interface Props {
	sparkCount?: number;
	loadingLabel?: string;
}

const { sparkCount = 15, loadingLabel = 'Loading...' } = Astro.props;

const sparks = Array.from({ length: sparkCount }).map(() => {
	// Trigonometry to find a point on the ring's radius
	const radius = 35; // Matches the 'inset' of the ring (relative to 140px container)
	const angle = Math.random() * 2 * Math.PI;

	// Calculate starting position relative to the center (70, 70)
	const startX = 70 + radius * Math.cos(angle);
	const startY = 70 + radius * Math.sin(angle);

	// Calculate "fling" direction (moving away from the center)
	const throwDistance = Math.random() * 40 + 20;
	const tx = Math.cos(angle) * throwDistance + 'px';
	const ty = Math.sin(angle) * throwDistance + 'px';

	return {
		left: startX + 'px',
		top: startY + 'px',
		tx,
		ty,
		duration: (Math.random() * 0.4 + 0.4).toFixed(2) + 's',
		delay: (Math.random() * 2).toFixed(2) + 's',
	};
});
---

<div class='forge-container' role='status' aria-label={loadingLabel}>
	<div class='vortex-ring'></div>

	{
		sparks.map((s) => (
			<div
				class='spark'
				style={{
					top: s.top,
					left: s.left,
					'--tx': s.tx,
					'--ty': s.ty,
					animationDuration: s.duration,
					animationDelay: s.delay,
				}}
			/>
		))
	}
</div>

<style>
	.forge-container {
		/* Default Fallbacks: These values are used IF global vars are missing */
		--warm: var(--loading-spinner-warm, #990000);
		--warmer: var(--loading-spinner-warmer, #ff9900);
		--hottest: var(--loading-spinner-hottest, #ffffff);
		position: relative;
		width: 140px;
		height: 140px;
		display: block;
		background: transparent;
	}

	.vortex-ring {
		position: absolute;
		inset: 35px; /* Radius is 35px from center */
		border-radius: 50%;
		background: conic-gradient(
			from 0deg,
			transparent 15%,
			var(--warm) 45%,
			var(--warmer) 85%,
			var(--hottest) 100%
		);
		-webkit-mask: radial-gradient(
			farthest-side,
			transparent calc(100% - 5px),
			#000 0
		);
		mask: radial-gradient(farthest-side, transparent calc(100% - 5px), #000 0);
		animation: molten-spin 1.8s linear infinite;
		z-index: 2;
	}

	/* White-hot lead point */
	.vortex-ring::after {
		content: '';
		position: absolute;
		top: -4px;
		left: 50%;
		transform: translateX(-50%);
		width: 10px;
		height: 10px;
		background: var(--hottest);
		border-radius: 50%;
		box-shadow: 0 0 15px 4px var(--warmer);
	}

	.spark {
		position: absolute;
		width: 2px;
		height: 2px;
		background: var(--hottest);
		border-radius: 50%;
		opacity: 0;
		z-index: 1;
		animation-name: centrifugal-ignite;
		animation-iteration-count: infinite;
		animation-timing-function: ease-out;
	}

	@keyframes molten-spin {
		to {
			transform: rotate(360deg);
		}
	}

	@keyframes centrifugal-ignite {
		0% {
			transform: translate(0, 0) scale(1);
			opacity: 0;
		}
		10% {
			opacity: 1;
		}
		100% {
			/* Now moves away from its specific birth point on the circle */
			transform: translate(var(--tx), var(--ty)) scale(0);
			opacity: 0;
		}
	}
</style>
