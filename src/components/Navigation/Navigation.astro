---
import Link from '@/components/Link.astro';
import Button from '@/components/Button.astro';
import { navItems } from './constants';
import { clsx } from 'clsx';

const currentPath = Astro.url.pathname;

const currentRoute = currentPath;
const isHomepage = currentRoute === '/';
const isRegisterPage = currentRoute === '/register/';
const isClassPage = currentRoute.startsWith('/classes/');
---

<nav
	class={`${clsx({
		home: isHomepage,
		register: isRegisterPage,
		classes: isClassPage,
	})} hidden md:block`}
>
	<ul class='list-none p-0 pl-4 font-serif font-bold'>
		{
			navItems.map((item, index) => {
				const subpagesUrls = item.subpages
					? item.subpages.map((subpage) => subpage.url)
					: [];

				const isActivePage = currentRoute === item.url;
				const hasActiveSubpage = subpagesUrls.includes(currentRoute);
				const containsOrIsActivePage = hasActiveSubpage || isActivePage;
				return (
					<li class={`${item.class} mt-4`}>
						<Link
							class={clsx({ "after:pl-1 after:content-['›']": isActivePage })}
							href={item.url}
						>
							{item.name}
						</Link>
						{item.subpages && (
							<ul
								class={`${
									containsOrIsActivePage ? 'block' : 'hidden'
								} list-none p-0 pl-4 font-sans text-sm font-normal`}
							>
								{item.subpages.map((subpage, index) => {
									const isActiveSubpage = currentRoute === subpage.url;
									return (
										<li class={`${subpage.class} mt-4`}>
											<Link
												class={`${clsx({ "after:pl-1 after:content-['›']": isActiveSubpage })}`}
												href={subpage.url}
											>
												{subpage.name}
											</Link>
										</li>
									);
								})}
							</ul>
						)}
					</li>
				);
			})
		}
		{
			!isRegisterPage && (
				<li class='pt-4'>
					<Button href='/register/'>Register</Button>
				</li>
			)
		}
	</ul>
</nav>
